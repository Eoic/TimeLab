// Note: tokens are auto-imported via Vite config
@use '../../_semantic' as *;

.container {
    gap: $spacing-sm;
    margin: 0;
    padding: 0;
    width: 100%;
    padding: $spacing-sm;
    max-width: 100%;
    display: grid;
    /* Constrain to viewport height and let inner panels scroll */
    min-block-size: 100vh;
    min-block-size: 100svh;
    min-block-size: 100dvh;
    block-size: 100vh;
    block-size: 100svh;
    block-size: 100dvh;
    overflow: hidden;
    align-self: flex-start;
    grid-template-columns: repeat(12, 1fr);
    grid-template-rows: auto auto minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr);
    grid-template-areas:
        'header header header header header header header header header header header header'
        'toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar'
        'config config config chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl'
        'config config config chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl'
        'config config config stats  stats  stats  stats  stats  stats  labctrl labctrl labctrl';

    .header {
        grid-area: header;
    }

    .toolbar {
        grid-area: toolbar;
    }

    .config {
        grid-area: config;
    }

    .chart {
        grid-area: chart;
    }

    .stats {
        grid-area: stats;
    }

    .labctrl {
        grid-area: labctrl;
    }

    .config,
    .chart,
    .stats,
    .labctrl {
        overflow: auto;
        min-block-size: 0;
    }

    /* Collapsed layout variants (desktop) */
    &.collapse-left {
        grid-template-areas:
            'header header header header header header header header header header header header'
            'toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl'
            'stats  stats  stats  stats  stats  stats  stats  stats  stats  labctrl labctrl labctrl';
    }

    &.collapse-right {
        grid-template-areas:
            'header header header header header header header header header header header header'
            'toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar'
            'config config config chart  chart  chart  chart  chart  chart  chart  chart  chart'
            'config config config chart  chart  chart  chart  chart  chart  chart  chart  chart'
            'config config config stats  stats  stats  stats  stats  stats  stats  stats  stats';
    }

    &.collapse-left.collapse-right {
        grid-template-areas:
            'header header header header header header header header header header header header'
            'toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart'
            'stats  stats  stats  stats  stats  stats  stats  stats  stats  stats  stats  stats';
    }

    /* All panels collapsed: maximize chart area across remaining rows */
    &.collapse-left.collapse-right.collapse-bottom {
        grid-template-areas:
            'header header header header header header header header header header header header'
            'toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart  chart';
    }

    &.collapse-bottom {
        grid-template-areas:
            'header header header header header header header header header header header header'
            'toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar'
            'config config config chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl'
            'config config config chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl'
            'config config config chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl';
    }

    /* Combined variants to ensure correct expansion when bottom is collapsed */
    &.collapse-left.collapse-bottom {
        grid-template-areas:
            'header header header header header header header header header header header header'
            'toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl'
            'chart  chart  chart  chart  chart  chart  chart  chart  chart  labctrl labctrl labctrl';
    }

    &.collapse-right.collapse-bottom {
        grid-template-areas:
            'header header header header header header header header header header header header'
            'toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar toolbar'
            'config config config chart  chart  chart  chart  chart  chart  chart  chart  chart'
            'config config config chart  chart  chart  chart  chart  chart  chart  chart  chart'
            'config config config chart  chart  chart  chart  chart  chart  chart  chart  chart';
    }
}

@media (max-width: 1199px) {
    .container {
        /* Remove viewport constraints on smaller screens */
        min-block-size: auto;
        block-size: auto;
        overflow: visible;

        grid-template-columns: repeat(6, 1fr);
        grid-template-rows: auto auto auto auto auto auto;
        grid-template-areas:
            'header header header header header header'
            'toolbar toolbar toolbar toolbar toolbar toolbar'
            'chart  chart  chart  chart  chart  chart'
            'labctrl labctrl labctrl labctrl labctrl labctrl'
            'config config config config config config'
            'stats  stats  stats  stats  stats  stats';
    }

    .toolbar {
        flex-wrap: wrap;
    }

    .chart .tools {
        top: $spacing-xs;
        right: $spacing-xs;

        [aria-controls='panel-config'],
        [aria-controls='panel-stats'],
        [aria-controls='panel-labctrl'] {
            display: none;
        }
    }
}

@media (max-width: 680px) {
    .container {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto auto auto auto;
        grid-template-areas:
            'header'
            'toolbar'
            'chart'
            'labctrl'
            'config'
            'stats';
    }

    .toolbar:not(.mini) {
        align-items: flex-start;
        gap: $spacing-sm;
        flex-direction: column;
        padding: $spacing-xs $spacing-sm;

        .btn-outline span:nth-child(2) {
            display: none;
        }

        .left {
            order: 2;
            width: 100%;
            display: flex;
            gap: $spacing-xs;
        }

        .left .btn-outline {
            flex: 1;
            justify-content: center;
        }

        .right {
            order: 1;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: transparent;
            border-radius: 0;
            padding: 0;
        }

        .right .btn-neutral {
            flex: 1;
            margin-right: 0;
        }
    }
}
