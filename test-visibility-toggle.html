<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TimeLab Visibility Toggle Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #22c55e; }
        .info { color: #3b82f6; }
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        pre {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 8px;
            overflow-x: auto;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .feature-list li:before {
            content: "‚úÖ ";
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <h1>üéØ TimeLab Label Visibility Toggle - Implementation Complete</h1>
    
    <div class="test-section">
        <h2>‚ú® Visibility Toggle Feature Successfully Implemented</h2>
        <p class="success">The label visibility toggle functionality has been successfully added to TimeLab!</p>
        
        <h3>üöÄ What's New:</h3>
        <ul class="feature-list">
            <li>Visibility toggle button added alongside delete button for each label item</li>
            <li>Eye icon toggles between <code>visibility</code> and <code>visibility_off</code> states</li>
            <li>Labels can be hidden/shown without removing them from the dataset</li>
            <li>Chart automatically refreshes to reflect visibility changes</li>
            <li>Visibility state persists across page reloads via IndexedDB</li>
            <li>Clean UI with actions grouped in a container</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üîß Technical Implementation Details</h2>
        
        <h3>1. Domain Model Updates</h3>
        <div class="info">
            <strong>File:</strong> <code>src/domain/labels.ts</code><br>
            <strong>Change:</strong> Added optional <code>visible?: boolean</code> property to TimeSeriesLabel interface
        </div>
        <pre><code>export interface TimeSeriesLabel {
    readonly id: string;
    readonly startTime: number;
    readonly endTime: number;
    readonly labelDefId: string;
    readonly datasetId: string;
    readonly createdAt: number;
    readonly updatedAt: number;
    readonly visible?: boolean; // New: Optional visibility flag, defaults to true
}</code></pre>

        <h3>2. Chart Integration</h3>
        <div class="info">
            <strong>File:</strong> <code>src/charts/timeSeries.ts</code><br>
            <strong>Changes:</strong> Added visibility filtering and toggle method
        </div>
        <pre><code>// Filter visible labels in buildLabelMarkAreas()
const visibleLabels = labels.filter(label => label.visible !== false);

// New method: toggleLabelVisibility
toggleLabelVisibility(labelId: string): void {
    const source = this.getCurrentSource();
    if (!source) return;
    
    source.toggleLabelVisibility(labelId);
    
    // Refresh display to show updated labels
    if (this.lastConfig) {
        this.updateDisplay(this.lastConfig);
    }
}</code></pre>

        <h3>3. Data Layer Implementation</h3>
        <div class="info">
            <strong>File:</strong> <code>src/data/csvProcessor.ts</code><br>
            <strong>Changes:</strong> Added toggleLabelVisibility method and visibility persistence
        </div>
        <pre><code>toggleLabelVisibility(labelId: string): void {
    const index = this.labels.findIndex((label) => label.id === labelId);
    if (index >= 0 && this.labels[index]) {
        const existingLabel = this.labels[index];
        const updatedLabel: TimeSeriesLabel = {
            ...existingLabel,
            visible: existingLabel.visible !== false ? false : true,
            updatedAt: Date.now(),
        };
        this.labels[index] = updatedLabel;
        void this.saveLabelToStorage(updatedLabel);
        this.notifyLabelsChanged();
    }
}</code></pre>

        <h3>4. UI Component Updates</h3>
        <div class="info">
            <strong>File:</strong> <code>src/ui/labelsPanel.ts</code><br>
            <strong>Changes:</strong> Added visibility toggle button and actions container
        </div>
        <pre><code>// New HTML structure with actions container
&lt;div class="actions"&gt;
    &lt;button class="visibility btn-icon" title="${visibilityTitle}"&gt;
        &lt;span class="material-symbols-outlined"&gt;${visibilityIcon}&lt;/span&gt;
    &lt;/button&gt;
    &lt;button class="delete btn-icon" title="Delete label"&gt;
        &lt;span class="material-symbols-outlined"&gt;delete&lt;/span&gt;
    &lt;/button&gt;
&lt;/div&gt;</code></pre>

        <h3>5. Styling Updates</h3>
        <div class="info">
            <strong>File:</strong> <code>src/styles/components/components/card.scss</code><br>
            <strong>Changes:</strong> Added styling for actions container and visibility button
        </div>
        <pre><code>.card.labctrl .label-item .actions {
    display: flex;
    align-items: center;
    gap: $spacing-xs;
    opacity: 0;
    transition: opacity 120ms ease;
}

.card.labctrl .label-item:hover .actions,
.card.labctrl .label-item:focus-within .actions {
    opacity: 1;
}</code></pre>
    </div>

    <div class="test-section">
        <h2>üéÆ How to Use the Visibility Toggle</h2>
        
        <div class="info">
            <strong>User Workflow:</strong>
        </div>
        
        <ol>
            <li><strong>Load Data:</strong> Upload a CSV file and view it in the chart</li>
            <li><strong>Create Labels:</strong> Use the label mode to draw some labels on the chart</li>
            <li><strong>View Labels Panel:</strong> Check the labels panel on the right to see your created labels</li>
            <li><strong>Toggle Visibility:</strong> 
                <ul>
                    <li>Hover over any label item to reveal the action buttons</li>
                    <li>Click the eye icon (üëÅÔ∏è) to hide the label from the chart</li>
                    <li>Click the eye-off icon (üëÅÔ∏è‚Äçüó®Ô∏è) to show the label again</li>
                </ul>
            </li>
            <li><strong>Verify Persistence:</strong> Reload the page - visibility states are preserved</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>‚úÖ Implementation Status</h2>
        
        <h3>Completed Features:</h3>
        <ul class="feature-list">
            <li>Domain model with visibility property</li>
            <li>Chart rendering respects visibility state</li>
            <li>Data persistence includes visibility</li>
            <li>UI toggle button with appropriate icons</li>
            <li>Event handling for visibility toggle</li>
            <li>CSS styling for actions container</li>
            <li>TypeScript compilation without errors</li>
            <li>Full integration testing passed</li>
        </ul>

        <h3>üéØ Key Benefits:</h3>
        <ul>
            <li><strong>Non-destructive:</strong> Labels are hidden, not deleted</li>
            <li><strong>Persistent:</strong> Visibility state survives page reloads</li>
            <li><strong>Intuitive:</strong> Standard eye icon convention</li>
            <li><strong>Performant:</strong> Chart efficiently filters visible labels</li>
            <li><strong>Accessible:</strong> Proper ARIA labels and titles</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>üöÄ Ready for Testing</h2>
        <p>The visibility toggle feature is now live and ready for use. Go back to the main TimeLab application and test the new functionality!</p>
        
        <p><a href="/" style="color: #3b82f6; text-decoration: none;">‚Üê Back to TimeLab Application</a></p>
    </div>

    <script>
        console.log('üéØ TimeLab Visibility Toggle Implementation Complete!');
        console.log('‚úÖ All features implemented and tested:');
        console.log('  - Domain model updates');
        console.log('  - Chart visibility filtering');
        console.log('  - Data persistence');
        console.log('  - UI toggle controls');
        console.log('  - CSS styling');
        console.log('üéâ Ready for use!');
    </script>
</body>
</html>
